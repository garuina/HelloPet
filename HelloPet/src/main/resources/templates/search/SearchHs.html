<th:block th:include="@{search/_header.html}"/>
<!-- 
날짜 : 2023-03-09 ~
이름 : 장인화
내용 : 동물병원 검색하고 결과를0 목록 ajax로 구현하기
 -->
<script>
$(function(){
	
var currentPage = 1;


 $('input[name=search]').keypress(function(event) {
        if (event.which == 13) { // Enter 키 누름
            $('#btnSh').click(); // 검색 버튼 클릭 이벤트 실행
        }
    });

$('#btnSh').click(function(){

let searchType = $('select[name=searchType]').val(); // 유형 선택	
let search = $('input[name=search]').val();// 검색 내용 뭐 썼는지
  	   console.log(search);
  	   
  	   if(search){
  		   $.ajax({
   	          url : '/HelloPet/search/SearchHs',
   	          type : 'POST',
   	          data : {"search": search,
   	        	  	 "searchType":searchType},
   	          success : function(data) {
   	        	  console.log(data);
 	        	  
 	        	  if(data != null){
 	        		  
 	        		  // #section3 숨기기
 	        		   $('#section3').hide();
 	        		  
 	        		  // #section2 보이기
 	        		  $('#section2').show();
				
 	        		  console.log(data);
  	              var html = "";
  	            if (data.hss.length > 0) {
  	              $.each(data.hss, function(index, hs) {
  	            	  var hosAddr = hs.hosAddr !== null ? hs.hosAddr : " "; // hosAddr가 null이면 공백 처리
  	            	  var tel = hs.tel !== null ? hs.tel : " "; // teldl null이면 공백 처리
  	                  html += "<li><span class='titleHs'><a href='/HelloPet/search/view?hosNo="+hs.hosNo+"'>" + hs.hosName + "</a></span>"
  	                  html += "<span class='infoHs'><span>" + hosAddr + "</span>"
  	                  html += "<span id='tel'>" + tel + "</span></span>"
  	                  html += "<span class='button-wrap'>"
  	                  html += "<a href='/HelloPet/search/view?hosNo="+hs.hosNo+"'><img src='/HelloPet/img/search-자세히.png'></a>";
  	                  html += "<a href='/HelloPet/search/reserve?hosNo="+hs.hosNo+"'><img src='/HelloPet/img/search-예약가능.png'></a></span></li>";;
  	              });
	  	          } else {//검색결과 없을 때 ㅠㅜ
	  	        	// #section2 숨기기
			        $('#section2').hide();
			        // #section3 내용 변경
			        $('#section3').html('검색결과가 없습니다.').show();
	  	        }
  	              
  	              
  	              
  	              $('.lists ul').empty();
  	              $('.lists ul').append(html);
  	              
  	              // 페이징처리 안됨 왜
  	              var pag = "";
  	              if(groups.size()> 0){
  	                  
  	                  if(groups[0]>1){
  	                      pag += "<a href='/HelloPet/search/SearchHs?pg="+(groups[0]-1)+"' class='prev'>이전</a>";
  	                  }
  	                  pag += "<ul>";
  	                  for(var i=groups[0]; i<=groups[1]; i++){
  	                      if(i==currentPage){
  	                          pag += "<li class='on'><a href='#'>"+i+"</a></li>";
  	                      }else{
  	                          pag += "<li><a href='/HelloPet/search/SearchHs?pg="+i+"'>"+i+"</a></li>";
  	                      }
  	                  }
  	                  pag += "</ul>";
  	                  if(groups[1]<lastPageNum){
  	                      pag += "<a href='/HelloPet/search/SearchHs?pg="+(groups[1]+1)+"' class='next'>다음</a>";
  	                  }
  	                  
  	              }
    	             
  	            $('.pagination').empty().append(pag);
  	              
				}
   	          }
   	    });
  	   }else{
  		   alert('검색어를 입력하세요');
  		   return false;
  	   }
});
});

</script>
        <div class="SearchHs">
          <div class="contents">
            <div class="search-top">
                <h3 class="title">동물병원 찾기</h3>
            </div>
            <section class="section1">
                <div class="container">
                    <div class="search-head">
                      <div class="search-box-container">
                         <div class="kt" style="display: inline-block">
                            <select id="searchType" name="searchType" title="검색 유형 선택">
                                <option value="all">전체 검색</option>
                                <option value="name">병원이름</option>
                                <option value="addr">주소</option>
                            </select>
                        </div>

                         <div class="inner" style="display: inline-block">
                             <input type="text" name="search">
                             <button type="button" id="btnSh"></button>
                         </div>        
                      </div>      
                   </div>  
                 </div>
            </section>
            <section id="section2" style="display: none;">
            	<input type="hidden" value="${hss.}">
            
                <div class="mapContainer">
                    <ul>
                        <li>
                            <img th:src="@{/img/search-병원.jpg}" alt="btnHs">
                        </li>
                    </ul>
                   <span class="option">
                        <a href="#">방문순</a>
                        <a href="#">최근등록순</a>
                        <a href="#">예약많은순</a>
                   </span>
                </div>
                <div class="lists">
                    <ul>
                       
                    </ul>
                </div>
         		<div id="pagination" class="pagination">
         		
         		</div>

            </section>
            
            <section id="section3">
                병원이름, 주소를 선택해서 동물병원을 검색해보세요!
            </section>
            

         </div>
        </div>
  <th:block th:include="@{search/_footer.html}"/>
<th:block th:include="@{search/_header.html}"/>
<!-- 
날짜 : 2023-03-14
이름 : 장인화
내용 : View에 병원,약국 자세히 결과, 지도 출력
 -->
 
 <main>
   
    <div><input type="hidden" name="addrs" th:value="${lists}"></div>
    <div><input type="hidden" name="addrs" th:each="list : ${lists}" th:value="${list.hosAddr}"></div>
        
    <div id="map" style="width:100%;height:350px; margin-top: 100px"></div>
      
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=5f25185293d664bcd951443d8b8e4a67&libraries=services"></script>
    <script>
 // 지도를 표시할 div 요소를 가져옵니다.
    var mapContainer = document.getElementById('map');

    // 지도 초기화 옵션을 설정합니다.
    var mapOption = {
      center: new kakao.maps.LatLng(37.56682, 126.97865), // 지도의 중심 좌표를 설정합니다.
      level: 3 // 지도의 확대 레벨을 설정합니다.
    };

    // 지도를 생성합니다.
    var map = new kakao.maps.Map(mapContainer, mapOption);

    // 병원 리스트를 가져옵니다.
    var hospitals = "${lists}";  // 병원 정보가 들어 있는 리스트 (주소 정보 포함)

    // 병원 리스트를 순회하면서 각 병원의 주소를 이용하여 위도, 경도 정보를 가져와 마커를 생성합니다.
    for (var i = 0; i < hospitals.length; i++) {
      var hospital = hospitals[i];

      // 지오코딩 객체를 생성합니다.
      var geocoder = new kakao.maps.services.Geocoder();

      // 주소로 좌표를 검색합니다.
      geocoder.addressSearch(hospital.hosAddr, function(result, status) {
        if (status === kakao.maps.services.Status.OK) {
          var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

          // 마커를 생성합니다.
          var marker = new kakao.maps.Marker({
            map: map,
            position: coords,
            title : hospital.name // 마커에 표시할 타이틀 설정
          });

          // 마커를 클릭하면 정보창을 표시합니다.
          kakao.maps.event.addListener(marker, 'click', function() {
            var infowindow = new kakao.maps.InfoWindow({
              content: hospital.name // 정보창에 표시할 내용 설정
            });
            infowindow.open(map, marker);
          });
        }
      });
    }
    </script>
</main>
<th:block th:include="@{search/_footer.html}"/>